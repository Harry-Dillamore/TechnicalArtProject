# Auto Landscape Materials - Harry Dillamore

## Height Based Blending System

| **Requirement** | **Description / Implementation** | **Evidence** |
| --- | --- | --- |
| **Landscape Material Setup** | I use material functions to set up each part of the material then use the `Landscape Layer Blend` node to combine these textures. This means that the material contains all of the materials and the user is able to paint the landscape once the material is applied. The heightmap input also allows the blending to use the heightmap of each texture in order to make a more convincing transition between materials. | <img alt="Landscape Material Setup" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-23.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 1 - Landscape material setup* |
| **Landscape Blending Based on Height** | The material system chooses the appropriate texture by using the `Absolute World Position` Z-axis. The aim is then to create a 0 - 1 value which is used as the alpha input for a `BlendMaterialAttributes` node which `LERPs` between two materials. To create this 0 - 1 value, I use configurable parameters to adjust: the `falloffHeight` which is subtracted from the Z-axis to set the level at which the material is applied, and the `falloffRange` which changes the size of the transition, with a larger number meaning that it blends more gradually over a larger distance in height. An example of how this system works would be if grass is applied with: `falloffHeight` = 25000, `falloffRange` = 2000. Then at a height of 26000 the calculation would be $ {26000-25000 \over 2000} = 0.5 $, meaning that the grass texture would be applied at half strength. To avoid values beyond 0 and 1, a `saturate` node is used to clamp anything outside of this range to either 0 or 1. I created different zones by adjusting the falloff height of the different materials in my landscape material instance. The values I found worked were as seen in the screenshot of my material parameters. I think these values were effective because they used large values for the falloff ranges, meaning that the blending was smooth. I think the look of this could be improved if some noise was introduced into the height blend as it would break up the bands of materials that can be seen when looking at the landscape. | <img alt="Height calculations" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-22.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 2 - Height Calculations* <br> <img alt="Image of landscape using height blended materials" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-20.png" style="cursor: pointer;" onclick="this.requestFullscreen();">  <br> *Figure 3 - Landscape using height blended materials* <br> <img alt="Birds eye view of landscape showing the materials" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-21.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 4 - landscape materials from above* <br> <img alt="Parameters of Landscape material instance" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-24.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 5 - Parameters of Landscape Material* |

## Slope Based Blending System

| **Requirement** | **Description / Implementation** | **Evidence** |
| --- | --- | --- |
| **Slope Calculation** | The landscape material blends textures using the world space slope of the landscape. This is done by taking the `VertexNormal` - which is a normalised Vector3 representing the direction that the vertex is facing in the world - and comparing it with an upwards vector (0, 0, 1) using a `dot Product`. The dot product node returns a value between 1 (if the vectors are the same) and -1 (if the vectors are pointing in opposite directions). This range is then remapped to set the parameter `FalloffPN` as the 0 end of the range, with a flat surface as 1. Meaning that the material will blend from fully visible on a flat surface, to gone at whichever value the user inputs with a smooth transition in between. | <img alt="Slope calculations" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-25.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 6 - Slope calculations* <br> <img alt="Image of slope blending in landscape" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-26.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 7 - Image of slope blending in landscape* |
| **Layer Blending** | I tried for a long time to get layer blending to work properly, however, I was finding that I could not get the materials layers to apply based on the procedural rules I had written. It should function by having each material filling the landscape, so that which material appears visually is decided by the height values of the layers (the material with the biggest height value would be most visible), which would be generated using the procedural rules. However, I could only get one material to fully cover the landscape at a time, I think means that the height blend was essentially never used because there were no overlapping materials. Instead, I have used a sequence of `BlendMaterial Attributes` nodes because this allows me to `LERP` in each material on top of each other, using my slope and height calculations as an alpha. This also allows me to choose which material has priority based on where they are in the order. I take advantage of this by using the rock as a base over the entire landscape, then blending dirt on top of it, then grass, then snow. In the material graph, I combine the slope and height based blending by multiplying the 2 values together to create the alpha for the `BlendMaterialAttributes` this means that when either the height mask or the slope mask are reduced, it reduces the visibility of the material. This creates a realistic effect and successfully combines the 2 effects. | <img alt="blend material attributes sequence" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/{C1CF7A82-9547-408A-8D7C-A3BA8A5934F0}.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 8 - Blend material attributes sequence* <br> <img alt="Landscape material setup" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/{7D82C9A8-0AEF-4C04-AC5B-DA87357DB2E9}.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *figure 9 - Landscape Material setup* <br> <img alt="landscape using height and slope blend" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-28.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 10 - Landscape using height and slope blend* | 
| **Guiding Questions** | Using slope based blending simulates real life landscapes and geology because, for example, you would not see grass growing or snow settling on steep cliff in real life. The `PNFalloff` and `PNContrast` parameters allow the user to adjust the steepness and blending area of the different materials, meaning that they can observe real life examples of the things similar to the material in use, and aim to match any patterns they see. Complex geometry and overhangs can be handled largely by the procedural system. This is because I have set the rock texture as the base texture, and draw everything else on top of it, for example, grass on flat surfaces below their falloff limit. This means that even if the geometry is overhanging or complex, if it does not meet the requirements for any other material to be painted, it would default to the rock texture.  |  |

## Foliage Type Integration and generation

| **Requirement** | **Description / Implementation** | **Evidence** |
| --- | --- | --- |
| **Foliage Types** | I created 6 different foliage types: grass, flowers, dense trees, sparse trees, small trees, and snowy trees. this variety allows me to create different areas of foliage cover within the landscape based on what is able to generate in each location. I also created a landscape grass type which covers all of the surface of the material by default when used. To control this many people tend to use paint layers to control where it generates. Instead of this I decided to create a set of height and slope controls, meaning I could expose the parameters to make adjustments very easy for anyone, and this automates most of the process. If I were working in a project with more man made features, I would want to also include a way to paint exclusion zones or similar. To balance performance, I turned off shadow casting on the grass and kept the culling distance at a reasonable value. | <img alt="Foliage types" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/{5C3A7552-42D8-4584-8511-B4485CB7DD86}.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 11 - Foliage types* <br> <img alt="Foliage in landscape" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-29.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 12 - Foliage in landscape* <br> <img alt="Landscape grass settings" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-30.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> *Figure 13 - Landscape grass settings* |
| **Procedual Placement** | Because I was unable to get the landscape layers to work properly, I couldn't use the layer inclusion and exclusion settings for the foliage. If I were to use them they should function by allowing me to specify specific layers and weights of those layers that I want to the foliage to generate. Making it easy to control what the foliage generation is like on each material. Because I was unable to do this, I was able to simulate it in a way by matching the upper and lower limits for height and slope in the foliage settings. This means I am able to create the same outcome as using material layers. In my landscape, I made trees and grass generate at lower heights (the same height as the grass material) and limited growth of all foliage on slopes to 45 degrees and below. I did this because it creates a more realistic looking environment, which follows what you would see in real environments (foliage not growing on rock and slopes). | <img alt="SMF_Tree details" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-34.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 14 - SMP_tree settings* |
| **Density and Distribution** | To create a believable pattern of foliage, I used several methods. I used `Clustering` settings on all procedural foliage to create natural groupings of foliage that simulate how real plants would grow. I also used multiple different tree types: one for dense trees which created large groups of trees at lower heights, one for sparse and more solitary trees towards the base of mountains, and one using a snowy tree model for trees high on the mountain. This created some realism because it reflects how you might expect to see trees growing. While working on creating a cohesive environment. I also adjusted the tint of some of the foliage so that they would match each other and the environment - creating a more intentional look. | <img alt="Trees at low height, start of mountain and top of mountain" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-31.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 15 - view of changing tree density <br> <img alt="Leaf Tint" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-35.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 16 - Leaf tint settings* |
| **Performance** | To balance visual quality and performance, the main techniques I used were: LODs, which allow you to reduce the quality of a mesh based on how far the player is from them. I edited some of the LODs as they were broken, for example, the trees were showing the bark texture on the leaves on some of the LODs which I was able to swap, greatly improving the look of the trees when viewed at a distance. I also turned on `DitheredLODTransition` in the settings of the relevant master materials - this makes the transition smoother and less jarring for the player. <br> Another way I increased the performance was by setting culling distances. I set quite short distances for grass and flowers because there are a large number of them and the details get messy and noisy at larger distances anyway. I set much longer distances for the trees because it is realistic that you would still be able to see them from far away and they contribute to the look of the landscape even when far away. Additionally, on the smaller meshes, I turned off casting shadows because I think the look fit well with the cel shaded environment, and it improves performance significantly because shadows are expensive. | <img alt="Dithering setting" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-32.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 17 - dithering settings on leaf material* <br> <img alt="LOD settings" src="https://pub-9c6c59cb1e3f474f938dca895e9f576d.r2.dev/image-33.png" style="cursor: pointer;" onclick="this.requestFullscreen();"> <br> *Figure 18 - LOD Settings tree* |

## Bibliography

CodeLikeMe (n.d.). *Unreal LOD Transition - UE4 Tutorials #305*. [YouTube video] Available at: YouTube.

UE4 Mentor (n.d.). *UE4 Smooth & Performant Foliage Fade-In - Tutorial*. [YouTube video] Available at: YouTube.

UnrealityBites (n.d.). *UE5 Hints & Tips - Foliage and Trees*. [YouTube video] Available at: YouTube.

### Declared Assets

**Google Gemini 2.5 pro** - Used for writing and adjusting parts of this document and debugging.

**NotebookLM** - Used for getting information from sources.

#### Materials

**Dirt Material** - <https://fab.com/s/539354ec05b8>

**Rock Material** <https://fab.com/s/a20813372f3c>

**Grass Material** <https://fab.com/s/9ef3388c0d1f>

**Snow Material** <https://fab.com/s/2087ebcc78ae>

#### Foliage

**temperate Vegetation: Spruce Forest** - <https://fab.com/s/de31b726d9df>

**temperate Vegetation: Foliage Collection** - <https://fab.com/s/f294bc8824ff>

**temperate Vegetation: Meadow Flowers** - <https://fab.com/s/99473343c0e6>